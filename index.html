<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CupidX â€” Compatibility Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <style>
    .hidden { display: none; }
    .modal-bg {
      background: rgba(0,0,0,0.4);
      position: fixed; top:0; left:0; width:100vw; height:100vh; z-index:50;
      display:flex; align-items:center; justify-content:center;
    }
    .spinner { border:2px solid #f3f3f3; border-radius:50%; border-top:2px solid #555; width:20px; height:20px; animation:spin .6s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    .fade-enter { animation: fadeIn .3s linear; }
    @keyframes fadeIn { 0%{opacity:0} 100%{opacity:1} }
  </style>
</head>
<body class="min-h-screen bg-gray-50 flex items-center justify-center">
  <main id="mainPanel" class="w-full max-w-sm mx-auto mt-8 p-6 bg-white shadow-lg rounded-lg">
    <!-- Registration Form (displays on load) -->
    <form id="regForm" autocomplete="off" class="space-y-4 fade-enter">
      <h1 class="text-xl font-bold mb-2 text-indigo-700">CupidX Registration</h1>
      <div>
        <label for="name" class="block font-medium mb-1">Full Name</label>
        <input id="name" name="name" type="text" required class="w-full p-2 border rounded" />
      </div>
      <div>
        <label for="email" class="block font-medium mb-1">Email</label>
        <input id="email" name="email" type="email" required class="w-full p-2 border rounded" />
      </div>
      <div>
        <label for="dob" class="block font-medium mb-1">Date of Birth</label>
        <input id="dob" name="dob" type="date" required class="w-full p-2 border rounded" />
      </div>
      <div class="flex items-start">
        <input id="consent" name="consent" type="checkbox" required class="mt-1 mr-2" />
        <label for="consent" class="text-sm">I consent to data processing and terms of service</label>
      </div>
      <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">
        Continue
      </button>
    </form>

    <!-- Loading Modal -->
    <div id="loadingModal" class="modal-bg hidden">
      <div class="bg-white p-6 rounded shadow-lg text-center">
        <div class="spinner mx-auto mb-4"></div>
        <p class="text-gray-700">Submitting...</p>
      </div>
    </div>

    <!-- Success Screen (hidden initially) -->
    <div id="successPanel" class="hidden space-y-4 fade-enter">
      <h1 class="text-xl font-bold text-green-600 mb-2">ðŸŽ‰ Registration Complete!</h1>
      <p class="text-gray-700">Thank you, <strong id="userName"></strong>!</p>
      <p class="text-sm text-gray-600">Your profile has been created. Check your email at <strong id="userEmail"></strong> for next steps.</p>
      <button id="goHomeBtn" class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">Go to Home</button>
    </div>
  </main>

  <script>
    // Initialize Supabase client
    const SUPABASE_URL = 'https://qcbndhtoedgjdjwdcnag.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjYm5kaHRvZWRnamRqd2RjbmFnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxNzAwNjEsImV4cCI6MjA3Nzc0NjA2MX0.7VNTClPKTVTMs6bKvkUp8x2RUOAbMxwyRXpS3wgvhcY';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const regForm = document.getElementById('regForm');
    const loadingModal = document.getElementById('loadingModal');
    const successPanel = document.getElementById('successPanel');
    const goHomeBtn = document.getElementById('goHomeBtn');

    regForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loadingModal.classList.remove('hidden');

      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const dob = document.getElementById('dob').value;
      const consent = document.getElementById('consent').checked;

      if (!name || !email || !dob || !consent) {
        alert('Please fill all required fields and accept consent.');
        loadingModal.classList.add('hidden');
        return;
      }

      try {
        const { data, error } = await supabase
          .from('users')
          .insert([
            {
              full_name: name,
              email: email,
              date_of_birth: dob,
              consent: consent
            }
          ])
          .select();

        loadingModal.classList.add('hidden');

        if (error) {
          console.error('Supabase error:', error);
          alert('Registration failed: ' + error.message);
        } else {
          console.log('Success:', data);
          document.getElementById('userName').textContent = name;
          document.getElementById('userEmail').textContent = email;
          regForm.classList.add('hidden');
          successPanel.classList.remove('hidden');
        }
      } catch (err) {
        loadingModal.classList.add('hidden');
        console.error('Unexpected error:', err);
        alert('An unexpected error occurred.');
      }
    });

    goHomeBtn.addEventListener('click', () => {
      location.reload();
    });
  </script>
</body>
</html>
